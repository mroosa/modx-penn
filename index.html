<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Pennsylvania | Perelman School of Medicine | University of Pennsylvania</title>

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/styles.css">

    </head>
    <body>
        <header>
            <div class="header_inner">
                <div class="logo_main">
                    <a href="https://www.med.upenn.edu/"><img src="https://www.med.upenn.edu/images/psom_logo_blue.svg" alt="Perelman School of Medicine at the University of Pennsylvania" width="213" height="60" /></a> 
                </div>
                <div class="logo_secondary">
                    <h2>Pennsylvania</h2>
                    <p>Birthplace of the nation</p>
                </div>
            </div>
        </header>
        <main>
            <section class="carousel full_width">
                <div class="carousel_wrap">
                    <div class="carousel_slide">
                        <img src="https://placehold.co/1200x800" alt="description">
                        <div class="carousel_slide_info">
                            <h2><span>Pennsylvania has Mountains and Rolling Hills</span></h2>
                            <p class="caption">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quaerat quidem obcaecati, ad fugiat adipisci dicta laudantium molestiae doloribus commodi natus possimus reprehenderit, saepe iusto! Corporis adipisci ipsa expedita perspiciatis. Iste.</p>
                            <p class="credit"><a href="#">Image Credit: John Doe</a></p>
                        </div>
                    </div>
                    <div class="carousel_slide">
                        <img src="https://placehold.co/1200x800" alt="description">
                        <div class="carousel_slide_info">
                            <h2><span>Aute irure dolor in reprehenderit in voluptate velit esse cillum pariatur</span></h2>
                            <p class="caption">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quaerat quidem obcaecati, ad fugiat adipisci dicta laudantium molestiae doloribus commodi natus possimus reprehenderit, saepe iusto! Corporis adipisci ipsa expedita perspiciatis. Iste.</p>
                            <a href="#" class="credit">Image Credit: John Doe</a>
                        </div>
                    </div>
                    <div class="carousel_slide">
                        <img src="https://placehold.co/1200x800" alt="description">
                        <div class="carousel_slide_info">
                            <h2><span>Irure dolor in reprehenderit in voluptate velit esse nulla pariatur</span></h2>
                            <p class="caption">Lorem ipsum dolor, sit amet consectetur adipisicing elit. Quaerat quidem obcaecati, ad fugiat adipisci dicta laudantium molestiae doloribus commodi natus possimus reprehenderit, saepe iusto! Corporis adipisci ipsa expedita perspiciatis. Iste.</p>
                            <a href="#" class="credit">Image Credit: John Doe</a>
                        </div>
                    </div>
                </div>

                <script>
                    let currentIndex = 0;
                    const carousel = document.querySelector('.carousel');
                    const slides = document.querySelectorAll('.carousel_slide');
                    const totalSlides = slides.length;

                    // create navigation dots
                    const carouselNav = document.createElement('ul');
                    carouselNav.classList.add('carousel_nav');
                    for (let i = 0; i < totalSlides; i++) {
                        const carouselDot = document.createElement('li');
                        const carouselDotLink = document.createElement('a');
                        carouselDotLink.setAttribute('href', '#');
                        if (i === 0) {
                            carouselDotLink.classList.add('active');
                        }
                        carouselDotLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            document.querySelector('.carousel_nav .active').classList.remove('active');
                            carouselDotLink.classList.add('active');
                            currentIndex = i;
                            showSlide(currentIndex);
                        });
                        carouselDot.appendChild(carouselDotLink);
                        carouselNav.appendChild(carouselDot);
                    }
                    carousel.appendChild(carouselNav);

                    // TODO: Use before/after positioning for seemless transitions in either direction.
                    const showSlide = (index) => {
                        document.querySelector('.carousel_wrap').style.transform = `translateX(-${index * 100}%)`;
                    }

                    // Initial display
                    showSlide(currentIndex);

                    // Create play/pause button
                    const playBtn = document.createElement('button');
                    playBtn.classList.add('carousel_play_btn','paused');
                    playBtn.setAttribute('aria-label', 'Play Carousel');
                    // Add play/pause buttons, control with CSS visibility
                    playBtn.innerHTML = '<span class="play"><i class="fa fa-play fa-xs"></i><span class="accessible_text"> Play</span></span><span class="pause"><i class="fa fa-pause fa-xs"></i><span class="accessible_text"> Pause</span></span>                    ';
                    carousel.appendChild(playBtn);
                    // Create interval for auto-advancing slides
                    playBtn.addEventListener('click', () => {
                        if (playBtn.classList.contains('playing')) {
                            clearInterval(carouselInterval);
                            playBtn.classList.remove('playing');
                            playBtn.classList.add('paused');
                        } else {
                            carouselInterval = setInterval(() => {
                                currentIndex = (currentIndex + 1) % totalSlides;
                                showSlide(currentIndex);
                            }, 5000);
                            playBtn.classList.remove('paused');
                            playBtn.classList.add('playing');
                        }
                    });
                </script>
            </section>
            <section class="content" x-ref="content">
                <div class="content_body">
                    <h1>The Commonwealth of Pennsylvania</h1>
                    <h2>Section One</h2>
                    <p>Paragraph body copy with <strong>bold elements</strong>, <em>italic elements</em>, and <a href="#">a clickable link</a>. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <h3>Subheading One</h3>
                    <p>Paragraph body copy with <strong>bold elements</strong>, <em>italic elements</em>, and <a href="#">a clickable link</a>. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <figure class="pull_right">
                        <a href="#"><img src="https://placehold.co/600x400" alt="description"></a>
                        <figcaption>Image caption describing the image.</figcaption>
                    </figure>
                    <h3>Subheading Two</h3>
                    <p>Paragraph body copy with <strong>bold elements</strong>, <em>italic elements</em>, and <a href="#">a clickable link</a>. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <h2>Section Two</h2>
                    <p>Paragraph body copy with <strong>bold elements</strong>, <em>italic elements</em>, and <a href="#">a clickable link</a>. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <h3 id="subheading-five">Subheading One</h3>
                    <p>Paragraph body copy with <strong>bold elements</strong>, <em>italic elements</em>, and <a href="#">a clickable link</a>. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p><a class="button" href="https://en.wikipedia.org/wiki/Pennsylvania">More Pennsylvania info on Wikipedia</a></p>
                </div>

                <script>

                    // Helper functions
                    const generateId = (element, text) => {
                        let linkId = '';
                        if (!element.getAttribute('id')) {
                            linkId = element.textContent.trim().toLowerCase().replace(/[^a-z0-9]+/g, '-');
                            element.setAttribute('id', linkId);
                        } else {
                            linkId = element.getAttribute('id');
                        }
                        return linkId;
                    }
                    const generateListItem = (id, text) => {
                        const linkListItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.setAttribute('href', `#${id}`);
                        link.textContent = text;
                        linkListItem.appendChild(link);
                        return linkListItem;
                    }

                    // Find content
                    const content = document.querySelector('.content_body');

                    // Generate the TOC structure if h2s are present
                    if (content.querySelectorAll('h2').length === 0) {
                        document.querySelector('.table_of_contents').style.display = 'none';
                    } else {
                        const toc = document.createElement('nav');
                        toc.classList.add('table_of_contents');
                        toc.setAttribute('aria-label', 'Table of Contents');

                        // Create heading, hr, and list
                        toc.innerHTML = '<h2>Jump down to:</h2><hr />';

                        // Use createElement in case its needed programatically later
                        const tocList = document.createElement('ul');
                        toc.appendChild(tocList);

                        content.querySelectorAll('h2').forEach(heading => {
                            // Sanitize the heading to make an ID for the headings
                            const linkId = generateId(heading);

                            // Create link based on heading ID
                            const tocLink = generateListItem(linkId, heading.textContent);

                            // Find any subheadings (h3) until the next h2
                            let nextElem = heading.nextElementSibling;
                            let subListItems = [];
                            while (nextElem && nextElem.tagName !== 'H2') {
                                if (nextElem.tagName === 'H3') {
                                    // Sanitize the heading to make an ID for the headings
                                    const subLinkId = generateId(nextElem);

                                    // Create link based on heading ID
                                    const subTocListItem = generateListItem(subLinkId, nextElem.textContent);
                                    subListItems.push(subTocListItem);

                                }
                                nextElem = nextElem.nextElementSibling;
                            }
                            // Generate a nested list if there are subheadings
                            if (subListItems.length > 0) {
                                const subList = document.createElement('ul');
                                subListItems.forEach(item => subList.appendChild(item));
                                tocLink.appendChild(subList);
                            }

                            // Wrap the contents (link or link + sublinks) in a list item and append
                            tocList.appendChild(tocLink);

                        }); 
                        // Append content to the page
                        content.after(toc);

                        window.addEventListener('scroll', () => {
                            if (toc.getBoundingClientRect().top < 20) {
                                toc.classList.add('fixed');
                            } else {
                                toc.classList.remove('fixed');
                            }

                            document.querySelectorAll('.table_of_contents a').forEach(link => {
                                const targetId = link.getAttribute('href').substring(1);
                                const targetElement = document.getElementById(targetId);
                                if (targetElement) {
                                    const rect = targetElement.getBoundingClientRect();
                                    // TODO: Find a low-cost way to check bounds on next element 
                                    if (rect.top <= 100 && rect.bottom >= -200) {
                                        link.classList.add('active');
                                    } else {
                                        link.classList.remove('active');
                                    }
                                }
                            });
                        });
                    }

                </script>

            </section>

        </main>
        <footer>
            <div class="footer_inner">
                <div class="footer_left">
                    <h2>Location</h2>
                    <p>Spanning the Mid-Atlantic, Northeastern, Appalachian, and Great Lakes regions of the United States.</p>
                    <p><i class="fa fa-phone"></i> <a href="tel:215-555-5555">215-555-5555</a></p>
                    <p><i class="fa fa-map"></i> <a href="#">Directions</a></p>
                </div>
                <div class="footer_right">
                    <h2>Search Our Site</h2>
                    <form id="search_form" action="#">
                        <input id="search_txt" name="search_txt" type="text" placeholder="Search Our Site..." />
                        <button id="submit" name="submit" class="icon_magnifying_glass"><i class="fa fa-search fa-2x"></i><span class="accessible_text"> Go</span></button>
                    </form>
                </div>
                <div class="footer_bottom">
                    <p>&copy; The Trustees of the University of Pennsylvania | Site best viewed in a <a href="#">supported browser</a>. | <a href="#">Report Accessibility Issues and Get Help</a> | <a href="#">Privacy Policy</a> | Site Design: <a href="#">PMACS Web Team.</a></p>
                </div>
            </div>
        </footer>

        <script src="https://kit.fontawesome.com/e166fb7e1c.js" crossorigin="anonymous"></script>

    </body>
</html>